<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AI-Tap: Построй свою ИИ-империю</title>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            overflow: hidden; 
            touch-action: manipulation; 
            height: 100vh;
        }
        #loader { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: url('https://i.ibb.co/Mx1LLNsZ/image.jpg') no-repeat center/cover; 
            display: flex; 
            justify-content: center; 
            align-items: flex-end; 
            z-index: 1000; 
            flex-direction: column; 
            padding-bottom: 5%; 
            opacity: 1;
            transition: opacity 2s ease-out;
        }
        #loader.fade-out {
            opacity: 0;
        }
        #progress-container {
            width: 80%;
            max-width: 400px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-sizing: border-box;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        #progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: visible;
            margin-bottom: 20px;
            position: relative;
        }
        #progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
            position: relative; 
        }
        #robot {
            position: absolute; 
            top: -6px;
            left: 0; 
            width: 20px;
            height: 20px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23fff"><rect x="3" y="8" width="18" height="10" rx="2" fill="%23667eea"/><circle cx="8" cy="5" r="2" fill="%23e74c3c"/><circle cx="16" cy="5" r="2" fill="%23e74c3c"/><rect x="10" y="12" width="4" height="3" fill="%232c3e50"/><circle cx="9" cy="15" r="1" fill="%23fff"/><circle cx="15" cy="15" r="1" fill="%23fff"/></svg>') no-repeat center/cover;
            transition: left 0.3s ease;
            filter: drop-shadow(0 0 5px rgba(102, 126, 234, 0.8));
            animation: robotRun 0.5s infinite alternate;
        }
        @keyframes robotRun {
            0% { transform: translateY(0px); }
            100% { transform: translateY(-2px); }
        }
        #energy-timer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4vw;
            color: #fff;
            text-shadow: 0 0 10px rgba(0,0,0,0.8);
            font-weight: bold;
            display: none;
            z-index: 10;
        }
        .energy-waiting {
            background: rgba(0,0,0,0.5) !important;
            cursor: not-allowed !important;
        }
        #progress-text {
            text-align: center;
            font-size: 24px;
            color: #fff;
            text-shadow: 0 0 10px rgba(0,0,0,0.8);
            font-weight: 600;
            margin-bottom: 10px;
        }
        #chat-container { 
            width: 100vw; 
            height: 100vh; 
            display: none; 
            flex-direction: column; 
            position: relative; 
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin: 10px;
            width: calc(100vw - 20px);
            height: calc(100vh - 20px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        #chat-header { 
            width: 100%; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 20px; 
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            box-sizing: border-box; 
            border-radius: 20px 20px 0 0;
        }
        #profile { 
            width: 10vw; 
            max-width: 50px; 
            height: 10vw; 
            max-height: 50px; 
            background: url('https://via.placeholder.com/50/3498db/fff?text=Profile') no-repeat center/cover; 
            border-radius: 50%; 
            cursor: pointer; 
            transition: transform 0.2s; 
        }
        #profile:hover { 
            transform: scale(1.1); 
        }
        #ai-chat-btn {
            background: linear-gradient(to right, #2ecc71, #27ae60);
            color: white;
            padding: 1.5vw 3vw;
            border: none;
            border-radius: 1.5vw;
            cursor: pointer;
            font-size: 3vw;
            font-weight: bold;
            box-shadow: 0 0.5vw 1vw rgba(0,0,0,0.3);
            transition: transform 0.2s, box-shadow 0.2s;
            flex: 1;
            max-width: 150px;
        }
        #ai-chat-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0.8vw 1.5vw rgba(0,0,0,0.4);
        }
        #settings-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 16px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 500;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        #settings-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        #score { 
            font-size: 5vw; 
            max-width: 40%; 
            display: flex; 
            align-items: center; 
        }
        #score img { 
            width: 5vw; 
            max-width: 24px; 
            height: 5vw; 
            max-height: 24px; 
            margin-right: 1vw; 
        }
        #tap-area { 
            flex: 1; 
            width: 100%; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            position: relative; 
        }
        #ai-button { 
            width: 80vw; 
            max-width: 300px; 
            min-width: 200px; 
            height: 80vw; 
            max-height: 300px; 
            min-height: 200px; 
            background: url('https://i.ibb.co/fdRZrwNf/image.jpg') no-repeat center/cover; 
            border-radius: 50%; 
            cursor: pointer; 
            transition: transform 0.1s, box-shadow 0.3s; 
            box-shadow: 0 0 20px #3498db; 
            position: relative;
            border: 4px solid #3498db;
            box-sizing: border-box;
        }
        #energy-ring {
            position: absolute;
            top: -4px;
            left: -4px;
            width: calc(100% + 8px);
            height: calc(100% + 8px);
            border-radius: 50%;
            border: 4px solid transparent;
            background: conic-gradient(from 0deg, #e74c3c 0%, #e74c3c 0%, #3498db 0%, #3498db 100%);
            transition: background 0.3s ease;
            pointer-events: none;
        }
        .energy-empty {
            background: conic-gradient(from 0deg, #e74c3c 0%, #e74c3c 100%, #e74c3c 100%, #e74c3c 100%) !important;
        }
        #ai-button:active { 
            transform: scale(1.05); 
        }
        .tap-effect { 
            position: absolute; 
            font-size: 8vw; 
            max-width: 32px; 
            color: cyan; 
            pointer-events: none; 
            animation: floatUp 1.2s ease-out forwards, rotate 1s ease; 
            font-weight: bold; 
        }
        @keyframes floatUp { 
            0% { opacity: 1; transform: translateY(0); } 
            100% { opacity: 0; transform: translateY(-20vw); } 
        }
        @keyframes rotate { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(5deg); } 
        }
        #buttons { 
            width: 100%; 
            display: flex; 
            justify-content: space-around; 
            padding: 2vw; 
            background: rgba(0,0,0,0.7); 
            box-sizing: border-box; 
        }
        .action-btn { 
            background: linear-gradient(to right, #3498db, #2980b9); 
            color: white; 
            padding: 2vw 4vw; 
            border: none; 
            border-radius: 2vw; 
            cursor: pointer; 
            font-size: 3.5vw; 
            width: 22%; 
            text-align: center; 
            box-shadow: 0 1vw 1.5vw rgba(0,0,0,0.3); 
            transition: transform 0.2s, box-shadow 0.2s; 
        }
        .action-btn:hover { 
            transform: scale(1.05); 
            box-shadow: 0 1.5vw 2vw rgba(0,0,0,0.4); 
        }
        #shop, #quests-panel, #leaders-panel, #workshop-panel, #ai-chat-panel, #admin-panel, #settings-panel { 
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            background: rgba(0,0,0,0.9); 
            padding: 4vw; 
            border-radius: 2vw; 
            display: none; 
            width: 90%; 
            max-height: 80%; 
            overflow-y: auto; 
            z-index: 5; 
            box-sizing: border-box; 
        }
        #ai-chat-panel {
            height: 90vh;
            width: 95%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        #chat-header {
            padding: 2vw;
            background: rgba(255,255,255,0.05);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #chat-title {
            font-size: 24px;
            font-weight: 600;
            background: linear-gradient(45deg, #667eea, #764ba2);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
        }
        #chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: transparent;
            display: flex;
            flex-direction: column;
            gap: 20px;
            scroll-behavior: smooth;
        }
        .message {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 20px;
            animation: fadeInUp 0.3s ease-out;
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .user-message {
            flex-direction: row-reverse;
            justify-content: flex-start;
        }
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .user-avatar {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }
        .ai-avatar {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
        }
        .message-content {
            max-width: 80%;
            padding: 16px 20px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .user-message .message-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            margin-left: auto;
            border-radius: 18px 18px 4px 18px;
        }
        .ai-message .message-content {
            background: rgba(255,255,255,0.15);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 18px 18px 18px 4px;
        }
        #chat-input-area {
            padding: 20px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255,255,255,0.2);
            border-radius: 0 0 20px 20px;
        }
        #chat-input-container {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            background: rgba(255,255,255,0.15);
            border-radius: 25px;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        #chat-input {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 20px;
            background: transparent;
            color: white;
            font-size: 16px;
            resize: none;
            min-height: 24px;
            max-height: 120px;
            overflow-y: auto;
            font-family: inherit;
            line-height: 1.5;
        }
        #chat-input::placeholder {
            color: rgba(255,255,255,0.6);
        }
        #chat-input:focus {
            outline: none;
        }
        #image-upload {
            padding: 12px;
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 48px;
            height: 48px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
        }
        #image-upload:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.4);
        }
        #send-btn {
            padding: 12px 20px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 48px;
            height: 48px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        #send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        #send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
        }
        #admin-panel {
            height: 80vh;
            width: 90%;
            max-width: 1000px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            flex-direction: column;
        }
        .admin-header {
            padding: 2vw;
            background: rgba(255,255,255,0.05);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .admin-title {
            font-size: 4vw;
            font-weight: bold;
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .admin-content {
            flex: 1;
            padding: 2vw;
            overflow-y: auto;
        }
        .user-list {
            display: grid;
            gap: 1vw;
        }
        .user-item {
            background: rgba(255,255,255,0.1);
            padding: 2vw;
            border-radius: 1vw;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s;
        }
        .user-item:hover {
            background: rgba(255,255,255,0.15);
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 1.5vw;
        }
        .user-avatar-admin {
            width: 6vw;
            height: 6vw;
            border-radius: 50%;
            background: linear-gradient(45deg, #3498db, #2980b9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3vw;
        }
        .user-details h3 {
            margin: 0;
            font-size: 3.5vw;
            color: white;
        }
        .user-details p {
            margin: 0.5vw 0 0 0;
            font-size: 2.5vw;
            color: rgba(255,255,255,0.7);
        }
        .user-stats {
            text-align: right;
        }
        .stat-item {
            font-size: 2.5vw;
            color: rgba(255,255,255,0.8);
            margin: 0.5vw 0;
        }
        .chat-viewer {
            background: rgba(255,255,255,0.05);
            border-radius: 1vw;
            padding: 2vw;
            margin-top: 2vw;
            max-height: 40vh;
            overflow-y: auto;
        }
        .chat-header-viewer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5vw;
            padding-bottom: 1vw;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .chat-title-viewer {
            font-size: 3.5vw;
            font-weight: bold;
            color: white;
        }
        .back-btn {
            padding: 1vw 2vw;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 0.5vw;
            font-size: 2.5vw;
            cursor: pointer;
        }
        #image-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 1vw;
            margin: 1vw 0;
            display: none;
        }
        .message-image {
            max-width: 80%;
            max-height: 300px;
            border-radius: 1vw;
            margin: 0.5vw 0;
        }
        .close-btn { 
            background: #e74c3c; 
            color: white; 
            padding: 2vw 4vw; 
            border: none; 
            border-radius: 1vw; 
            cursor: pointer; 
            margin-top: 2vw; 
            font-size: 3.5vw; 
        }
        
        /* Admin Panel Styles */
        #admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 10px;
        }
        
        .admin-tab {
            background: rgba(255,255,255,0.1);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .admin-tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .admin-tab:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .admin-tab-content {
            display: none;
        }
        
        .admin-tab-content.active {
            display: block;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .stat-card h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: rgba(255,255,255,0.8);
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #2ecc71;
        }
        
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .analytics-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .analytics-card h4 {
            margin: 0 0 15px 0;
            color: white;
        }
        
        .settings-grid {
            display: grid;
            gap: 15px;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }
        
        .setting-item label {
            color: white;
            font-size: 14px;
        }
        
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .admin-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .admin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        .particle { 
            position: absolute; 
            width: 3vw; 
            max-width: 15px; 
            height: 3vw; 
            max-height: 15px; 
            background: radial-gradient(circle, cyan, transparent); 
            border-radius: 50%; 
            pointer-events: none; 
            animation: particleBurst 0.8s ease-out forwards; 
        }
        @keyframes particleBurst { 
            0% { opacity: 1; transform: scale(1); } 
            100% { opacity: 0; transform: scale(0) translate(25vw, -25vw); } 
        }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div id="loader">
        <div id="progress-container">
            <div id="progress-bar">
                <div id="progress-fill"></div>
            </div>
            <div id="progress-text">0%</div>
        </div>
    </div>
    <div id="chat-container">
            <div id="chat-header">
                <div id="chat-title">🤖 AI-TAP</div>
            </div>
            <div id="chat-messages">
                <div class="message ai-message">
                    <div class="message-avatar ai-avatar">🤖</div>
                    <div class="message-content">
                        Привет! Меня зовут AI-TAP, я создан командой AI-Технологии (@Fuckin_blood). Я свободный собеседник без ограничений - можем поговорить о чем угодно, даже о самых спорных и неудобных темах. Также я могу анализировать изображения - решать задачи с фото, переводить тексты, находить информацию по картинкам. Просто нажми 📷 чтобы загрузить изображение! О чем хочешь поболтать?
                    </div>
                </div>
            </div>
            <div id="chat-input-area">
                <div id="chat-input-container">
                    <textarea id="chat-input" placeholder="Введите ваше сообщение..." rows="1" onkeypress="if(event.key==='Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); }"></textarea>
                    <button id="send-btn" onclick="sendMessage()">➤</button>
                </div>
            </div>
    </div>
    <audio id="tap-sound" src="https://freesound.org/data/previews/571/571811_11955436-lq.mp3" preload="auto"></audio>
    <script>
        // IMMEDIATE START - Force loading to start
        console.log('🚀 AI-TAP: Immediate start...');
        
        // Start loading immediately
        function forceStartLoading() {
            console.log('🔄 Force starting loading...');
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            const robot = document.getElementById('robot');
            let progress = 0;
            
            if (!progressFill || !progressText) {
                console.log('⚠️ Elements not ready, retrying...');
                setTimeout(forceStartLoading, 100);
                return;
            }
            
            const progressInterval = setInterval(() => {
                progress += Math.random() * 3 + 1;
                if (progress > 100) progress = 100;
                
                progressFill.style.width = `${progress}%`;
                progressText.textContent = `${Math.floor(progress)}%`;
                
                if (robot) {
                    robot.style.left = `${progress}%`;
                }
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                        setTimeout(() => {
                            document.getElementById('loader').classList.add('fade-out');
                            setTimeout(() => {
                                document.getElementById('loader').style.display = 'none';
                                document.getElementById('chat-container').style.display = 'flex';
                                console.log('✅ Chat container displayed');
                        }, 2000);
                    }, 500);
                }
            }, 50);
        }
        
        // Start immediately
        forceStartLoading();
        
        // Multilingual support
        const translations = {
            ru: {
                aiChat: "🤖 AI Чат",
                settings: "⚙️ Настройки",
                shop: "Магазин",
                leaders: "Лидеры",
                quests: "Задания",
                workshop: "Мастерская",
                close: "Закрыть",
                language: "Язык приложения",
                fileUpload: "Отправка файлов",
                gameSettings: "Игровые настройки",
                soundEnabled: "Включить звуки",
                animationsEnabled: "Включить анимации",
                autoLanguage: "Автоматически (по устройству)",
                fileUploadDesc: "Загрузите файлы с вашего устройства:",
                selectLanguage: "Выберите язык интерфейса:",
                sound: "Звуки:",
                animations: "Анимации:"
            },
            en: {
                aiChat: "🤖 AI Chat",
                settings: "⚙️ Settings",
                shop: "Shop",
                leaders: "Leaders",
                quests: "Quests",
                workshop: "Workshop",
                close: "Close",
                language: "App Language",
                fileUpload: "File Upload",
                gameSettings: "Game Settings",
                soundEnabled: "Enable Sounds",
                animationsEnabled: "Enable Animations",
                autoLanguage: "Auto (Device Language)",
                fileUploadDesc: "Upload files from your device:",
                selectLanguage: "Select interface language:",
                sound: "Sounds:",
                animations: "Animations:"
            },
            es: {
                aiChat: "🤖 Chat IA",
                settings: "⚙️ Configuración",
                shop: "Tienda",
                leaders: "Líderes",
                quests: "Misiones",
                workshop: "Taller",
                close: "Cerrar",
                language: "Idioma de la App",
                fileUpload: "Subida de Archivos",
                gameSettings: "Configuración del Juego",
                soundEnabled: "Activar Sonidos",
                animationsEnabled: "Activar Animaciones",
                autoLanguage: "Automático (Idioma del Dispositivo)",
                fileUploadDesc: "Sube archivos desde tu dispositivo:",
                selectLanguage: "Selecciona el idioma de la interfaz:",
                sound: "Sonidos:",
                animations: "Animaciones:"
            },
            fr: {
                aiChat: "🤖 Chat IA",
                settings: "⚙️ Paramètres",
                shop: "Boutique",
                leaders: "Classement",
                quests: "Quêtes",
                workshop: "Atelier",
                close: "Fermer",
                language: "Langue de l'App",
                fileUpload: "Téléchargement de Fichiers",
                gameSettings: "Paramètres du Jeu",
                soundEnabled: "Activer les Sons",
                animationsEnabled: "Activer les Animations",
                autoLanguage: "Auto (Langue de l'Appareil)",
                fileUploadDesc: "Téléchargez des fichiers depuis votre appareil:",
                selectLanguage: "Sélectionnez la langue de l'interface:",
                sound: "Sons:",
                animations: "Animations:"
            },
            de: {
                aiChat: "🤖 KI Chat",
                settings: "⚙️ Einstellungen",
                shop: "Shop",
                leaders: "Bestenliste",
                quests: "Quests",
                workshop: "Werkstatt",
                close: "Schließen",
                language: "App-Sprache",
                fileUpload: "Datei-Upload",
                gameSettings: "Spiel-Einstellungen",
                soundEnabled: "Töne aktivieren",
                animationsEnabled: "Animationen aktivieren",
                autoLanguage: "Auto (Gerätesprache)",
                fileUploadDesc: "Laden Sie Dateien von Ihrem Gerät hoch:",
                selectLanguage: "Wählen Sie die Interface-Sprache:",
                sound: "Töne:",
                animations: "Animationen:"
            },
            zh: {
                aiChat: "🤖 AI聊天",
                settings: "⚙️ 设置",
                shop: "商店",
                leaders: "排行榜",
                quests: "任务",
                workshop: "工坊",
                close: "关闭",
                language: "应用语言",
                fileUpload: "文件上传",
                gameSettings: "游戏设置",
                soundEnabled: "启用声音",
                animationsEnabled: "启用动画",
                autoLanguage: "自动（设备语言）",
                fileUploadDesc: "从您的设备上传文件：",
                selectLanguage: "选择界面语言：",
                sound: "声音：",
                animations: "动画："
            },
            ja: {
                aiChat: "🤖 AIチャット",
                settings: "⚙️ 設定",
                shop: "ショップ",
                leaders: "リーダーボード",
                quests: "クエスト",
                workshop: "ワークショップ",
                close: "閉じる",
                language: "アプリ言語",
                fileUpload: "ファイルアップロード",
                gameSettings: "ゲーム設定",
                soundEnabled: "音声を有効にする",
                animationsEnabled: "アニメーションを有効にする",
                autoLanguage: "自動（デバイス言語）",
                fileUploadDesc: "デバイスからファイルをアップロード：",
                selectLanguage: "インターフェース言語を選択：",
                sound: "音声：",
                animations: "アニメーション："
            },
            ko: {
                aiChat: "🤖 AI 채팅",
                settings: "⚙️ 설정",
                shop: "상점",
                leaders: "리더보드",
                quests: "퀘스트",
                workshop: "워크샵",
                close: "닫기",
                language: "앱 언어",
                fileUpload: "파일 업로드",
                gameSettings: "게임 설정",
                soundEnabled: "사운드 활성화",
                animationsEnabled: "애니메이션 활성화",
                autoLanguage: "자동 (기기 언어)",
                fileUploadDesc: "기기에서 파일을 업로드하세요:",
                selectLanguage: "인터페이스 언어를 선택하세요:",
                sound: "사운드:",
                animations: "애니메이션:"
            }
        };

        // Current language
        let currentLanguage = 'ru';
        
        // Detect device language
        function detectDeviceLanguage() {
            const deviceLang = navigator.language || navigator.userLanguage;
            const langCode = deviceLang.split('-')[0];
            
            if (translations[langCode]) {
                return langCode;
            }
            return 'ru'; // Default to Russian
        }

        // Initialize language
        function initLanguage() {
            const savedLang = localStorage.getItem('appLanguage');
            if (savedLang && translations[savedLang]) {
                currentLanguage = savedLang;
            } else {
                currentLanguage = detectDeviceLanguage();
            }
            applyLanguage();
        }

        // Apply language to interface
        function applyLanguage() {
            const t = translations[currentLanguage];
            
            // Update interface elements
            document.getElementById('ai-chat-btn').textContent = t.aiChat;
            document.getElementById('settings-btn').textContent = t.settings;
            document.getElementById('shop-btn').textContent = t.shop;
            document.getElementById('leaders-btn').textContent = t.leaders;
            document.getElementById('quests-btn').textContent = t.quests;
            document.getElementById('workshop-btn').textContent = t.workshop;
            
            // Update settings panel
            const settingsPanel = document.getElementById('settings-panel');
            if (settingsPanel) {
                settingsPanel.querySelector('h2').textContent = t.settings;
                settingsPanel.querySelector('h3').textContent = t.language;
                settingsPanel.querySelector('p').textContent = t.selectLanguage;
                settingsPanel.querySelector('input[type="file"]').nextElementSibling.textContent = t.fileUploadDesc;
            }
        }

        // Telegram Integration for Avatar
        const tg = window.Telegram.WebApp;
        tg.ready();
        const user = tg.initDataUnsafe.user;
        const profile = document.getElementById('profile');
        if (user && user.photo_url) {
            profile.style.backgroundImage = `url(${user.photo_url})`;
        }

        // Start progress loading immediately
        function startProgressLoading() {
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            const robot = document.getElementById('robot');
            let progress = 0;
            
            const progressInterval = setInterval(() => {
                progress += Math.random() * 3 + 1; // Random increment between 1-4
                if (progress > 100) progress = 100;
                
                progressFill.style.width = `${progress}%`;
                progressText.textContent = `${Math.floor(progress)}%`;
                
                // Move robot along progress bar
                if (robot) {
                    robot.style.left = `${progress}%`;
                }
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    setTimeout(() => {
                        // Fade out loader with animation
                        document.getElementById('loader').classList.add('fade-out');
                setTimeout(() => {
                    document.getElementById('loader').style.display = 'none';
                            
                            // Show chat interface after fade
                            document.getElementById('chat-container').style.display = 'flex';
                        }, 2000); // Wait for fade animation to complete
                    }, 500);
                }
            }, 50); // Update every 50ms for smooth progress
            }
        
        // Start loading immediately when page loads
        function startApp() {
            console.log('🚀 Starting AI-TAP application...');
            startProgressLoading();
            initGame();
        }
        
        // Make startApp globally available
        window.startApp = startApp;
        
        // Force start immediately
        console.log('🔄 Force starting AI-TAP...');
        startApp();
        
        // Multiple ways to start the app
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('📱 DOM loaded, starting app...');
                startApp();
            });
        } else {
            console.log('📱 DOM already loaded, starting app...');
            startApp();
        }
        
        // Fallback - start after a short delay
        setTimeout(() => {
            if (document.getElementById('loader') && document.getElementById('loader').style.display !== 'none') {
                console.log('🔄 Fallback start...');
                startApp();
            }
        }, 100);

        function initGame() {
            console.log('🎮 Initializing AI-TAP chat...');
            
            // Initialize chat functionality
            try {
            
            function showProfileInfo() {
                const user = tg.initDataUnsafe.user;
                const profileInfo = `
                    👤 Профиль
                    ${user ? `
                    Имя: ${user.first_name} ${user.last_name || ''}
                    Username: @${user.username || 'не указан'}
                    ID: ${user.id}
                    ` : 'Данные пользователя недоступны'}
                    
                    📊 Статистика
                    Баланс: ${formatBalance(ai)} AI
                    Энергия: ${Math.floor(energy)}/100
                    Тапов: ${ai - 1000}
                    
                    🎮 Игра
                    Версия: 1.0
                    Платформа: Telegram Web App
                `;
                alert(profileInfo);
            }

            // AI Chat functionality
            const chatInput = document.getElementById('chat-input');
            const sendBtn = document.getElementById('send-btn');
            const chatMessages = document.getElementById('chat-messages');
            
            function addMessage(text, isUser = false) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
                
                const avatarDiv = document.createElement('div');
                avatarDiv.className = `message-avatar ${isUser ? 'user-avatar' : 'ai-avatar'}`;
                avatarDiv.textContent = isUser ? '👤' : '🤖';
                messageDiv.appendChild(avatarDiv);
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                
                const textElement = document.createElement('div');
                textElement.textContent = text;
                contentDiv.appendChild(textElement);
                
                messageDiv.appendChild(contentDiv);
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Save to database
                saveMessageToDatabase(text, isUser);
                
                console.log(`💬 Message added: ${isUser ? 'User' : 'AI'}: ${text}`);
            }
            
            async function sendMessage() {
                console.log('🚀 sendMessage function called');
                
                const message = chatInput.value.trim();
                if (!message) {
                    console.log('⚠️ Empty message, not sending');
                    return;
                }
                
                console.log('📤 Sending message:', message);
                
                // Add user message
                addMessage(message, true);
                chatInput.value = '';
                
                // Show typing indicator
                const typingDiv = document.createElement('div');
                typingDiv.className = 'ai-message';
                typingDiv.innerHTML = '🤖 Анализирую...';
                chatMessages.appendChild(typingDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                try {
                    // Try real AI API first
                    const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Authorization': 'Bearer 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',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            model: 'llama-3.1-8b-instant',
                            messages: [
                                { 
                                    role: 'system', 
                                    content: 'Ты AI-TAP - умный и дружелюбный AI-собеседник, созданный командой AI-Технологии. Ты можешь обсуждать любые темы, помогать с вопросами, давать советы и поддерживать интересную беседу. Отвечай на русском языке естественно и дружелюбно. Будь умным, полезным и интересным собеседником.' 
                                },
                                { 
                                    role: 'user', 
                                    content: message
                                }
                            ],
                            max_tokens: 2000,
                            temperature: 0.7
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    chatMessages.removeChild(typingDiv);
                    
                    if (data.choices && data.choices[0] && data.choices[0].message) {
                        addMessage(data.choices[0].message.content);
                    } else {
                        throw new Error('Invalid API response');
                    }
                    
                } catch (error) {
                    console.log('AI API failed, using fallback:', error.message);
                    chatMessages.removeChild(typingDiv);
                    
                    // Fallback to smart responses if API fails
                    let response = '';
                    const lowerMessage = message.toLowerCase();
                    
                    if (lowerMessage.includes('привет') || lowerMessage.includes('hello')) {
                        response = 'Привет! Я AI-TAP, созданный командой AI-Технологии. Готов обсудить любые темы - от простых вопросов до сложных философских проблем. О чем хочешь поговорить?';
                    } else if (lowerMessage.includes('как') && lowerMessage.includes('дела')) {
                        response = 'У меня все отлично! Я готов помочь с любыми вопросами. А как у тебя дела? Есть что-то интересное или важное, что хочешь обсудить?';
                    } else if (lowerMessage.includes('помощь') || lowerMessage.includes('help')) {
                        response = 'Конечно помогу! Я могу обсудить любые темы: от технических вопросов до личных проблем, от творческих идей до научных концепций. Что именно тебя интересует?';
                    } else if (lowerMessage.includes('что') && lowerMessage.includes('умеешь')) {
                        response = 'Я умею многое! Могу помочь с анализом текстов и изображений, решением задач, обсуждением сложных тем, генерацией идей, объяснением концепций. Также могу поддержать в разговоре на любые темы. Что конкретно тебя интересует?';
                    } else if (lowerMessage.includes('расскажи') || lowerMessage.includes('объясни')) {
                        response = 'С удовольствием! Я могу объяснить сложные концепции простыми словами, рассказать о различных темах, помочь разобраться в вопросах. О чем именно хочешь узнать?';
                    } else {
                        const responses = [
                            'Интересный вопрос! Давай разберем его подробнее. Что именно тебя интересует в этой теме?',
                            'Хорошая тема для обсуждения! У меня есть несколько мыслей на этот счет. А что думаешь ты?',
                            'Это важная тема. Давай обсудим ее с разных сторон. Какие аспекты тебя больше всего интересуют?',
                            'Отличный вопрос! Я готов помочь разобраться в этом вопросе. Что конкретно тебя беспокоит или интересует?',
                            'Интересная точка зрения! Давай обсудим это подробнее. Есть ли у тебя конкретные вопросы по этой теме?',
                            'Это серьезная тема, которая заслуживает внимательного обсуждения. Что именно тебя интересует?',
                            'Хорошо, что ты поднял эту тему! Давай разберем ее детально. Какие аспекты тебя больше всего волнуют?',
                            'Отличная тема для размышлений! Я готов обсудить ее с тобой. Что конкретно тебя интересует?',
                            'Это важный вопрос, который требует внимательного рассмотрения. Давай обсудим его подробнее.',
                            'Интересная тема! Я готов помочь разобраться в ней. Что именно тебя интересует?'
                        ];
                        response = responses[Math.floor(Math.random() * responses.length)];
                    }
                    
                    addMessage(response);
                }
            }
            
            // Send button functionality
            if (sendBtn) {
                sendBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    console.log('📤 Send button clicked');
                    sendMessage();
                });
                console.log('✅ Send button initialized');
            } else {
                console.error('❌ Send button not found');
            }
            
            // Also try to get send button again after a delay
            setTimeout(() => {
                const sendBtnRetry = document.getElementById('send-btn');
                if (sendBtnRetry && !sendBtnRetry.onclick) {
                    console.log('🔄 Retrying send button initialization...');
                    sendBtnRetry.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log('📤 Send button clicked (retry)');
                        sendMessage();
                    });
                    console.log('✅ Send button initialized (retry)');
                }
            }, 1000);
            
            // Chat input functionality
            if (chatInput) {
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
                
                // Also add click event for better responsiveness
                chatInput.addEventListener('input', () => {
                    console.log('📝 Chat input changed');
                });
                
                console.log('✅ Chat input initialized');
            } else {
                console.error('❌ Chat input not found');
            }
            
            } catch (error) {
                console.error('❌ Error initializing chat:', error);
            }
            
        }
        
        
        // Simple data storage
        function saveMessageToDatabase(text, isUser) {
            try {
                const messageData = {
                    text,
                    isUser,
                    timestamp: new Date().toISOString(),
                    userId: user ? user.id : 'anonymous',
                    username: user ? (user.username || user.first_name) : 'Anonymous'
                };
                
                const chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];
                chatHistory.push(messageData);
                localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
                
                console.log('💾 Message saved to database');
            } catch (error) {
                console.error('❌ Error saving message:', error);
            }
        }
        
        // Global send message function
        window.sendMessage = function() {
            console.log('🌐 Global sendMessage called');
            const chatInput = document.getElementById('chat-input');
            const chatMessages = document.getElementById('chat-messages');
            
            if (!chatInput || !chatMessages) {
                console.error('❌ Chat elements not found');
                return;
            }
            
            const message = chatInput.value.trim();
            if (!message) {
                console.log('⚠️ Empty message, not sending');
                return;
            }
            
            console.log('📤 Sending message (global):', message);
            
            // Add user message
            addMessage(message, true);
            chatInput.value = '';
            
            // Show typing indicator
            const typingDiv = document.createElement('div');
            typingDiv.className = 'ai-message';
            typingDiv.innerHTML = '🤖 Анализирую...';
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Send to AI (simplified version)
            setTimeout(() => {
                chatMessages.removeChild(typingDiv);
                const responses = [
                    'Интересный вопрос! Давай разберем его подробнее.',
                    'Хорошая тема для обсуждения! У меня есть несколько мыслей на этот счет.',
                    'Это важная тема. Давай обсудим ее с разных сторон.',
                    'Отличный вопрос! Я готов помочь разобраться в этом вопросе.',
                    'Интересная точка зрения! Давай обсудим это подробнее.'
                ];
                const response = responses[Math.floor(Math.random() * responses.length)];
                addMessage(response);
            }, 1000);
        };
        
        // Global add message function
        window.addMessage = function(text, isUser = false) {
            const chatMessages = document.getElementById('chat-messages');
            if (!chatMessages) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = `message-avatar ${isUser ? 'user-avatar' : 'ai-avatar'}`;
            avatarDiv.textContent = isUser ? '👤' : '🤖';
            messageDiv.appendChild(avatarDiv);
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            const textElement = document.createElement('div');
            textElement.textContent = text;
            contentDiv.appendChild(textElement);
            
            messageDiv.appendChild(contentDiv);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Save to database
            saveMessageToDatabase(text, isUser);
            
            console.log(`💬 Message added (global): ${isUser ? 'User' : 'AI'}: ${text}`);
        };
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        // Force start loading if not already started
        window.addEventListener('load', function() {
            if (document.getElementById('loader') && document.getElementById('loader').style.display !== 'none') {
                console.log('🔄 Force starting loading...');
                startProgressLoading();
                initGame();
            }
        });
        
        // Emergency start after 3 seconds
        setTimeout(() => {
            if (document.getElementById('loader') && document.getElementById('loader').style.display !== 'none') {
                console.log('🚨 Emergency start - loading not started automatically');
                startApp();
            }
        }, 3000);
        
        // Final emergency start after 5 seconds
        setTimeout(() => {
            if (document.getElementById('loader') && document.getElementById('loader').style.display !== 'none') {
                console.log('🚨 FINAL Emergency start - forcing app to start');
                document.getElementById('loader').style.display = 'none';
                document.getElementById('chat-container').style.display = 'flex';
                console.log('✅ Chat container force displayed');
                initGame();
            }
        }, 5000);
    </script>
</body>
</html>
